-----------------------------1.	Database Design Section 1. DDL 
CREATE TABLE Planes
(Id      INT
 PRIMARY KEY IDENTITY, 
 [Name]  VARCHAR(30) NOT NULL, 
 Seats   INT NOT NULL, 
 [Range] INT NOT NULL
);

CREATE TABLE Flights
(Id            INT
 PRIMARY KEY IDENTITY, 
 DepartureTime DATETIME2, 
 ArrivalTime   DATETIME2, 
 [Origin]      VARCHAR(50) NOT NULL, 
 [Destination] VARCHAR(50) NOT NULL, 
 PlaneId       INT NOT NULL
                   FOREIGN KEY REFERENCES Planes(Id)
);

CREATE TABLE Passengers
(Id         INT
 PRIMARY KEY IDENTITY, 
 FirstName  VARCHAR(30) NOT NULL, 
 LastName   VARCHAR(30) NOT NULL, 
 Age        INT NOT NULL, 
 Address    VARCHAR(30) NOT NULL, 
 PassportId CHAR(11) NOT NULL
);

CREATE TABLE LuggageTypes
(Id     INT
 PRIMARY KEY IDENTITY, 
 [Type] VARCHAR(30) NOT NULL
);

CREATE TABLE Luggages
(Id            INT
 PRIMARY KEY IDENTITY, 
 LuggageTypeId INT NOT NULL
                   FOREIGN KEY REFERENCES LuggageTypes(Id), 
 PassengerId   INT NOT NULL
                   FOREIGN KEY REFERENCES Passengers(Id),
);

CREATE TABLE Tickets
(Id            INT
 PRIMARY KEY IDENTITY, 
 PassengerId   INT NOT NULL
                   FOREIGN KEY REFERENCES Passengers(Id), 
 FlightId      INT NOT NULL
                   FOREIGN KEY REFERENCES Flights(Id), 
 LuggageId INT NOT NULL
                   FOREIGN KEY REFERENCES Luggages(Id), 
 Price         DECIMAL(18, 2) NOT NULL
);

-----------------------------2.	Insert
INSERT INTO Planes ([Name], Seats, [Range]) VALUES
	('Airbus 336', 112, 5132),
	('Airbus 330', 432, 5325),
	('Boeing 369', 231, 2355),
	('Stelt 297', 254, 2143),
	('Boeing 338', 165, 5111),
	('Airbus 558', 387, 1342),
	('Boeing 128', 345, 5541)

INSERT INTO LuggageTypes ([Type]) Values
	('Crossbody Bag'),
	('School Backpack'),
	('Shoulder Bag')


-----------------------------3.	Update
--Make all flights to "Carlsbad" 13% more expensive

UPDATE Tickets
SET Price *= 1.13
FROM  Tickets AS t
	JOIN Flights AS f ON t.FlightId = f.Id
WHERE f.Destination = 'Carlsbad'

UPDATE dbo.Tickets
  SET 
      dbo.Tickets.Price*=1.13
WHERE dbo.Tickets.FlightId IN
(
    SELECT f.Id
    FROM dbo.Flights f
    WHERE f.Destination = 'Carlsbad'
);


-----------------------------4.	Delete
--Delete all flights to " Ayn Halagim ".

DECLARE @flightId int = (SELECT f.Id FROM dbo.Flights f WHERE f.Destination = 'Ayn Halagim')

DELETE FROM dbo.Tickets
WHERE dbo.Tickets.FlightId = @flightId

-----------------------------5.	The "Tr" Planes
--Select all of the planes, which name contains "tr". 
--Order them by id (ascending), name (ascending), seats (ascending) and range (ascending).

SELECT *
FROM Planes
WHERE Name LIKE '%tr%'
ORDER BY Id, [Name], Seats, Range

-----------------------------6.	Flight Profits
--Select the total profit for each flight from database. Order them by total price 
--(descending), flight id (ascending).

SELECT f.Id, Sum(t.Price)
FROM Flights AS f
JOIN Tickets AS t ON f.Id = t.FlightId
GROUP BY f.Id
ORDER BY Sum(t.Price) DESC, f.Id ASC

-----------------------------7.	Passenger Trips
--Select the full name of the passengers with their trips (origin - destination).
--Order them by full name (ascending), origin (ascending) and destination (ascending).

SELECT CONCAT(p.FirstName, ' ', p.LastName) AS [Full Name], f.Origin, f.Destination
FROM Passengers AS p
JOIN Tickets AS t ON t.PassengerId = p.Id
JOIN Flights AS f ON t.FlightId = f.Id
ORDER BY [Full Name] ASC, f.Origin, f.Destination





